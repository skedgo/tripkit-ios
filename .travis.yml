language: objective-c
osx_image: xcode9
xcode_sdk: iphonesimulator10.0
xcode_workspace: Project/TripKit.xcworkspace
xcode_scheme:
    - TripKit

# Non-standard Podfile and opt-into caching of pods
podfile: Project/Podfile
cache: cocoapods
rvm:
  - 2.2.1 # See https://docs.travis-ci.com/user/osx-ci-environment/

before_install:
  - echo -e "machine github.com\n  login $CI_USER_TOKEN" >> ~/.netrc
  - brew update
  - gem install xcpretty --no-rdoc --no-ri --no-document --quiet
  - gem install cocoapods
  - pod --version

# We use xcodebuild rather than xctool as xctool doesn't play nicely with network requests
script: set -o pipefail && xcodebuild test -workspace Project/TripKit.xcworkspace -scheme TripKit -sdk iphonesimulator -destination 'platform=iOS Simulator,name=iPhone 7' | xcpretty